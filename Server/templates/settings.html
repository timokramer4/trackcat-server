{% extends "model/logged.html" %}

{% block subcontent %}
<div class="container-fluid px-xl-5">
  <section class="py-5">
    <div class="row mb-4">
      <div class="col-lg-5 mb-5">
        <div class="card">
          <div class="card-header">
            <h2 class="h6 text-uppercase mb-0">Profilbild</h2>
          </div>
          <div class="card-body">
            <div class="row align-items-center flex-row">
              <div class="col-lg-4 text-center mb-4">
                <img
                  src="{% if user.img == None %}{{ url_for('static', filename='img/defaultUser.jpg')}}{% else %}data:image/jpeg;base64,{{ user.img | safe }}{% endif %}"
                  width="150px" class="img-fluid rounded-circle shadow">
              </div>
              <div class="col-lg-8">
                <h2 class="mb-0 d-flex align-items-center">
                  <span id="settings_account_name">{{user.firstName}} {{user.lastName}}</span>
                </h2>
                <span class="text-muted text-uppercase small"><span id="online_state"
                    class="dot bg-green d-inline-block mr-2"></span>
                  Online</span>
                <hr><small class="text-muted" id="settings_account_email">{{user.id}}</small>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-7 mb-5">
        <div class="card mb-4">
          <div class="card-header">
            <h3 class="h6 text-uppercase mb-0">Allgemeine Einstellungen</h3>
          </div>
          <div class="card-body">
            <p>Im folgenden Abschnitt hast du die Möglichkeit deine allgemeinen Profilinformationen zu ändern:</p>
            <form id="editGenerals">
              <div class="form-group">
                <div class="custom-control custom-radio custom-control-inline">
                  <input id="maleGender" type="radio" name="genderRadio" class="custom-control-input"
                    {% if user.gender == 1 %}checked="true" {% endif %} validate>
                  <label for="maleGender" class="custom-control-label">Herr</label>
                </div>
                <div class="custom-control custom-radio custom-control-inline">
                  <input id="femaleGender" type="radio" name="genderRadio" class="custom-control-input"
                    {% if user.gender == 0 %}checked="true" {% endif %} validate>
                  <label for="femaleGender" class="custom-control-label">Frau</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-control-label text-uppercase">Vorname</label>
                <input type="text" id="firstName" placeholder="Vorname" maxlength="16" class="form-control"
                  value="{{user.firstName}}" validate>
              </div>
              <div class="form-group">
                <label class="form-control-label text-uppercase">Nachname</label>
                <input type="text" id="lastName" placeholder="Nachname" maxlength="16" class="form-control"
                  value="{{user.lastName}}" validate>
              </div>
              <div class="form-group">
                <label class="form-control-label text-uppercase">Geburtstag</label>
                <input type="date" id="birthday" class="form-control" validate>
                <script>
                  var date = new Date("{{ user.dateOfBirth }}" * 1000);
                  document.getElementById("birthday").value = getDate(date);
                </script>
              </div>
              <button type="button" id="editGeneralsBtn" class="btn btn-primary shadow px-5" disabled>Speichern</button>
            </form>
          </div>
        </div>
        <div class="card">
          <div class="card-header">
            <h3 class="h6 text-uppercase mb-0">Passwort ändern</h3>
          </div>
          <div class="card-body">
            <p>Hier kannst du dein Passwort ändern. Das Passwort ermöglicht dir den Zugang zu deinem Konto:</p>
            <form id="changePassword">
              <div class="row">
                <div class="col-lg-6 mb-3">
                  <div class="form-group">
                    <label class="form-control-label text-uppercase">Aktuelles Passwort</label>
                    <input type="password" id="currentPass" placeholder="Aktuelles Passwort" maxlength="15"
                      class="form-control" validate>
                  </div>
                </div>
                <div class="col-lg-6 mb-2">
                  <div class="form-group">
                    <label class="form-control-label text-uppercase">Neues Passwort</label>
                    <input type="password" id="newPass" placeholder="Neues Passwort" maxlength="15" class="form-control"
                      validateNewPass="1">
                  </div>
                  <div class="form-group">
                    <label class="form-control-label text-uppercase">Neues Passwort wdh.</label>
                    <input type="password" id="newPass2" placeholder="Neues Passwort wdh." maxlength="15"
                      class="form-control" validateNewPass="2">
                  </div>
                </div>
                <div class="col align-self-end">
                  <button type="button" id="changePasswordBtn" class="btn btn-primary shadow px-5"
                    disabled>Ändern</button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>
{% endblock %}

{% block customScripts %}
<script src="{{ url_for('static', filename='js/validate.js')}}"></script>
<script>
  /* Edit general profile data */
  initializeValidation("editGenerals");
  $("#editGeneralsBtn")[0].addEventListener("click", function () {
    // TODO: Senden der Daten an Server
    var gender = $("#maleGender")[0].checked ? 1 : 0;
    var firstName = $("#firstName")[0].value;
    var lastName = $("#lastName")[0].value;
    var birthday = $("#birthday")[0].value != "" ? Math.round((new Date($("#birthday")[0].value)).getTime() / 1000) : "{{ user.dateOfBirth }}";
    var json = { "email": "{{user.id}}", "newemail": "{{user.id}}", "firstName": firstName, "lastName": lastName, "gender": gender, "dateOfBirth": birthday, "size": "{{user.size}}", "weight": "{{user.weight}}" };
    console.log(json);

    $.ajax({
      url: '/updateUserAPI',
      type: 'post',
      dataType: 'json',
      contentType: 'application/json',
      success: function (data) {
        $('#target').html(data.msg);
      },
      data: JSON.stringify(json)
    });

    console.log("Allgemeine Daten geändert!");
  });

  /* Change personal password */
  initializeValidation("changePassword");
  $("#changePasswordBtn")[0].addEventListener("click", function () {
    // TODO: Senden der Daten an Server
    console.log("Passwort geändert!");
  });
</script>
{% endblock %}